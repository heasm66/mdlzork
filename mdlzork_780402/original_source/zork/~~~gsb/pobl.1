<NEWTYPE PSTRING WORD>
<NEWTYPE POBLIST UVECTOR '<<PRIMTYPE UVECTOR> [REST LIST]>>
<SETG PPSTRING <ISTRING 5>>

<DEFINE MPOBLIST (ATM LEN)
    #DECL ((ATM) ATOM (LEN) FIX)
    <SETG .ATM <CHTYPE <IUVECTOR .LEN ()> POBLIST>>>

<TITLE STRINGP>
	<DECLARE ("VALUE" STRING PSTRING)>
	<DPUSH	TP* (AB)>
	<PUSHJ	P* ISTRP>
	<JRST	FINIS>

<INTERNAL-ENTRY ISTRP 1>
	<SUBM	M* (P)>
	<MOVE	A* <TYPE-WORD STRING>>
	<MOVE	B* <MQUOTE <RGLOC PPSTRING T>>>
	<ADD	B* GLOTOP 1>
	<MOVE	B* 1(B)>
	<MOVE	C* (TP)>
	<MOVE	D* [<(*440700*) C>]>
	<SETZ	E*>
STRPLP	<ILDB	D>
	<JUMPE	STRPGO>
	<CAIN	E* 5>
	 <JRST	STRPGO>
	<AOJA	E* STRPLP>

STRPGO	<HRR	A* E>
	<MOVEM	C* 1(B)>
	<JRST	MPOPJ>


<TITLE PSTRING>
	<DECLARE ("VALUE" PSTRING STRING)>
	<DPUSH	TP* (AB)>
	<PUSHJ	P* IPSTR>
	<JRST	FINIS>

<INTERNAL-ENTRY IPSTR 1>
	<SUBM	M* (P)>
	<MOVE	A* (TP)>
	<HLRZ	C* A>
	<CAIN	C* *10700*>
	 <JRST	PSTR1>
	<MOVE	B* (A)>
	<HRRZ	C* -1(TP)>
	<SUBI	C* 5>
	<MOVNS	C>
	<IMULI	C* 7>
	<LSH	B* (C)>
	<CAIA>
PSTR1	 <MOVE	B* 1(A)>
	<MOVE	A* <TYPE-WORD PSTRING>>
	<SUB	TP* [<(2) 2>]>
	<JRST	MPOPJ>

<TITLE PINSERT>
	<DECLARE ("VALUE" ANY STRING POBLIST ANY)>
	<DPUSH	TP* (AB)>
	<DPUSH	TP* 2(AB)>
	<DPUSH	TP* 4(AB)>
	<PUSHJ	P* IPINS>
	<JRST	FINIS>

<INTERNAL-ENTRY IPINS 3>
	<SUBM	M* (P)>
	<MOVE	A* -4(TP)>
	<HRRZ	B* -5(TP)>
	<HLRE	C* -2(TP)>
	<MOVNS	C>
	<PUSHJ	P* PHASH>
	<PUSH	P* A>
	<ADD	A* -2(TP)>
	<PUSH	TP* <TYPE-WORD PSTRING>>
	<MOVE	B* -5(TP)>
	<PUSH	TP* 1(B)>
	<PUSH	TP* -3(TP)>
	<PUSH	TP* -3(TP)>
	<MOVE	B* (A)>
	<MOVE	A* <TYPE-WORD LIST>>
	<MOVEI	O* SEGMNT>
	<PUSH	P* [2]>
	<PUSHJ	P* RCALL>
	<POP	P* A>
	<PUSHJ	P* IILIST>
	<POP	P* A>
	<ADD	A* -2(TP)>
	<MOVEM	B* (A)>
	<DMOVE	A* -1(TP)>
	<SUB	TP* [<(6) 6>]>
	<JRST	MPOPJ>

PHASH	<SUBM	M* (P)>
	<MOVE	D* [3.1416]>
PHLOOP	<ILDB	E* A>
	<TSC	D* E>
	<ROT	D* (E)>
	<SOJN	B* PHLOOP>
	<IDIV	D* C>
	<MOVM	A* E>
	<JRST	MPOPJ>

<SUB-ENTRY PLOOKUP ("VALUE" ANY STRING POBLIST)>
	<DPUSH	TP* (AB)>
	<DPUSH	TP* 2(AB)>
	<PUSHJ	P* IPLKP>
	<JRST	FINIS>

<INTERNAL-ENTRY IPLKP 2>
	<SUBM	M* (P)>
	<MOVE	A* -2(TP)>
	<HRRZ	B* -3(TP)>
	<HLRE	C* (TP)>
	<MOVNS	C>
	<PUSHJ	P* PHASH>
	<ADD	A* (TP)>
	<SKIPN	B* (A)>
	 <JRST	PLOSE>
	<MOVE	A* -2(TP)>
	<HLRZ	C* A>
	<CAIN	C* *10700*>
	 <JRST	PSTR1>
	<MOVE	A* (A)>
	<HRRZ	C* -3(TP)>
	<SUBI	C* 5>
	<IMULI	C* 7>
	<MOVNS	C>
	<LSH	A* (C)>
	<CAIA>
PSTR1	 <MOVE	A* 1(A)>
PLOOP	<CAMN	A* 1(B)>
	 <JRST	PWIN>
	<HRRZ	B* (B)>
	<HRRZ	B* (B)>
	<JUMPN	B* PLOOP>

PLOSE	<MOVE	A* <TYPE-WORD FALSE>>
	<SUB	TP* [<(4) 4>]>
	<JRST	MPOPJ>

PWIN	<HRRZ	B* (B)>
	<MOVE	A* (B)>
	<MOVE	B* 1(B)>
	<SUB	TP* [<4 (4)>]>
	<JRST	MPOPJ>

	<END>

